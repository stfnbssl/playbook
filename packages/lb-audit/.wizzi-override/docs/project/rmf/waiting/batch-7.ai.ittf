ai rmf.step_1
    api-url http://localhost:3005
    call Risk Assessment (System)
        llm_service deepseek
        llm_model deepseek-chat
        max_tokens 8192
        temperature 0.2
        description rmf step - Risk Assessment (System)
        message 
            role system
            content 
                \n Sei un assistente che genera SOLO JSON UTF-8 valido, senza testo fuori dal JSON.
                \n Sei un esperto di cybersecurity in contesto OT/ICS
                \n Conosci particolarmente bene gli standard di sicurezza IEC 62443 e NIST.
        message 
            role user
            content 
                \n [MODALITÀ]
                \n context_mode: "task"
                \n task_id: "P-18"
                \n task_name: "System Registration"
                \n [CONTESTO (SLICE)]
                \n context_input: {"system":{"id":"SYS-PAK-001","name":"Linea Confezionamento X","mission":"Garantire throughput di imballaggio e tracciabilità lotto."},"assets":[{"id":"PLC-1","name":"PLC Siemens S7-1500","category":"hardware","subcategory":"PLC","vendor":"Siemens","model":"S7-1500","criticality":"high","owned_by":"OEM"},{"id":"HMI-1","name":"HMI Windows 10 Embedded","category":"hardware","subcategory":"HMI","vendor":"Generic","model":"W10E","criticality":"moderate","owned_by":"OEM"},{"id":"FW-1","name":"Firmware OEM confezionatrice","category":"firmware","criticality":"high","owned_by":"OEM"},{"id":"DATA-REC","name":"Ricette di produzione","category":"data","criticality":"high","owned_by":"Customer"},{"id":"NET-OT","name":"Rete OT interna","category":"network","criticality":"moderate","owned_by":"Customer"}],"interfaces":[{"name":"OT-LAN","direction":"bidirectional","exposure":"internal","protocols":["Profinet"],"counterparty":"linea di produzione"},{"name":"VPN manutenzione","direction":"bidirectional","exposure":"external","protocols":["IPsec","RDP"],"counterparty":"OEM Service"},{"name":"Telemetria Cloud","direction":"outbound","exposure":"external","protocols":["HTTPS/TLS"],"counterparty":"Cloud Provider Z"}],"information":{"types":[{"name":"ricette","sensitivity":"confidential","retention_days":365,"lifecycle":["storage","transmission","retention","disposal"]},{"name":"log operativi","sensitivity":"internal","retention_days":90,"lifecycle":["collection","processing","storage","retention","disposal"]},{"name":"badge operatore","sensitivity":"personal","retention_days":30,"lifecycle":["collection","processing","storage","retention","disposal"]}]},"authorization_boundary":{"in_scope":["PLC","HMI","firmware OEM","ricette su HMI"],"out_of_scope":["rete fabbrica cliente","SIEM cliente","Active Directory cliente"],"responsibilities":[{"subject":"patch firmware","owner":"OEM","notes":"Erogate via finestra manutenzione"},{"subject":"account management","owner":"Customer","notes":"Creazione/rotazione account operatori"},{"subject":"telemetria cloud","owner":"ThirdParty","notes":"Contratto con Provider Z"}]},"security_basics":{"remote_maintenance":true,"uses_cloud":true,"logging_monitoring":"Log HMI su syslog locale; forward al SIEM cliente (out-of-scope)","known_threats":["ransomware HMI","manipolazione ricette"],"constraints":["compatibilità legacy con driver HMI","uptime 24/7, finestre patch limitate"]}}
                \n [OBIETTIVO]
                \n Genera minacce e requisiti collegati a:
                \n - attacchi malware,
                \n - errori di configurazione,
                \n - supply chain vulnerabilities.
                \n ⚠️ Istruzione importante:
                \n Devi restituire SOLO JSON valido conforme allo schema seguente:
                \n {"$schema":"https://json-schema.org/draft/2020-12/schema","$id":"https://example.com/schemas/rmf-oem-brainstorming.essential.schema.json","title":"RMF OEM Brainstorming Output (Essential)","description":"Output minimo per brainstorming di minacce e requisiti collegati a controlli IEC 62443 / NIST.","type":"object","additionalProperties":false,"required":["meta","context","results"],"properties":{"meta":{"type":"object","additionalProperties":false,"required":["version","generated_at","generator"],"properties":{"version":{"type":"string","description":"Versione documento logico (es. 1.0.0)"},"generated_at":{"type":"string","format":"date-time","description":"Timestamp ISO 8601"},"generator":{"type":"object","additionalProperties":false,"required":["name"],"properties":{"name":{"type":"string","description":"Nome/ID del modello"},"version":{"type":"string","description":"Versione del modello (se nota)"}}}}},"context":{"type":"object","additionalProperties":false,"required":["system_core","rmf_tasks_considered"],"properties":{"system_core":{"type":"object","additionalProperties":false,"required":["id","name","mission"],"properties":{"id":{"type":"string","description":"ID sistema"},"name":{"type":"string","description":"Nome sistema"},"mission":{"type":"string","description":"Mission/obiettivo"}}},"rmf_tasks_considered":{"type":"array","minItems":1,"uniqueItems":true,"items":{"type":"string","pattern":"^P-(8|9|1[0-8])$"}}}},"results":{"type":"object","additionalProperties":false,"required":["threat_scenarios"],"properties":{"threat_scenarios":{"type":"array","minItems":1,"items":{"$ref":"#/$defs/threatScenario"}},"summary":{"type":"object","additionalProperties":false,"properties":{"top_risks":{"type":"array","items":{"type":"string"},"description":"ID scenari prioritari"}}}}}},"$defs":{"threatScenario":{"type":"object","additionalProperties":false,"required":["id","title","assets","threat","requirements"],"properties":{"id":{"type":"string","description":"ID scenario (es. TSC-001)"},"title":{"type":"string","description":"Titolo sintetico"},"assets":{"type":"array","minItems":1,"items":{"type":"string"},"description":"Asset coinvolti (ID o nomi brevi)"},"threat":{"type":"object","additionalProperties":false,"required":["category","description"],"properties":{"category":{"type":"string","enum":["malware","unauthorized-access","network-eavesdrop","misconfiguration","supply-chain","physical","insider","dos","data-exfiltration","safety-impact","other"]},"description":{"type":"string"}}},"vulnerabilities":{"type":"array","items":{"type":"string"}},"consequences":{"type":"array","items":{"type":"string"}},"requirements":{"type":"array","minItems":1,"items":{"$ref":"#/$defs/requirement"}},"risk":{"$ref":"#/$defs/riskScore"},"priority":{"type":"string","enum":["low","medium","high"],"description":"Priorità di trattamento"},"task_links":{"type":"array","items":{"type":"object","additionalProperties":false,"required":["task_id"],"properties":{"task_id":{"type":"string","pattern":"^P-(8|9|1[0-8])$"},"note":{"type":"string"}}}},"assumptions":{"type":"array","items":{"type":"string"},"description":"Assunzioni (se input incompleto)"}}},"requirement":{"type":"object","additionalProperties":false,"required":["statement","controls"],"properties":{"statement":{"type":"string","description":"Requisito di protezione"},"controls":{"type":"array","minItems":1,"items":{"$ref":"#/$defs/controlRef"}},"parameters":{"type":"array","items":{"$ref":"#/$defs/parameter"}}}},"controlRef":{"type":"object","additionalProperties":false,"required":["standard","id"],"properties":{"standard":{"type":"string","enum":["IEC 62443-3-3","IEC 62443-4-2","NIST 800-53","NIST 800-82"]},"id":{"type":"string","description":"Es. 'SR 5.2', 'CR 1.2', 'AC-2', 'SC-7'","pattern":"^(SR \\\\d+(?:\\\\.\\\\d+)?|CR \\\\d+(?:\\\\.\\\\d+)?|[A-Z]{2,3}-\\\\d{1,3}(?:\\\\([a-z]\\\\))?)$"},"note":{"type":"string","description":"Nota opzionale"}}},"parameter":{"type":"object","additionalProperties":false,"required":["name","value"],"properties":{"name":{"type":"string","description":"Es. password_min_length, tls_min"},"value":{"type":["string","number","integer","boolean"]},"unit":{"type":"string"},"rationale":{"type":"string"}}},"riskScore":{"type":"object","additionalProperties":false,"required":["likelihood","impact"],"properties":{"likelihood":{"type":"integer","minimum":1,"maximum":5,"description":"Probabilità 1..5"},"impact":{"type":"integer","minimum":1,"maximum":5,"description":"Impatto 1..5 (sintetico su C/I/A)"},"score":{"type":"number","description":"Opz.: calcolo (es. L*I)"},"rationale":{"type":"string","description":"Motivazione breve"}}}}}
                \n [REGOLE]
                \n - Usa solo le informazioni in context_input + system_core.
                \n - Se mancano dati necessari, NON inventare: compila "assumptions" e "missing_fields".
                \n - Riempi i campi "task_links" con {"task_id": "P-10"}.
                \n [Linee guida]
                \n - Popola "context" con i dati forniti sopra (senza inventare).
                \n - Genera almeno 3 threat_scenarios in "results".
                \n - Ogni scenario deve includere ≥1 requirement con controlli associati.
                \n - Istanzia parametri concreti quando possibile (es. password_min_length=12).
                \n - Compila "risk" con scala 1..5 e motivazione.
                \n - Usa ID coerenti (es. TSC-###, REQ-###).
                \n - Non includere testo fuori dal JSON.
                \n ⚠️ Restituisci SOLO JSON valido conforme allo schema di output definito in precedenza.
                \n ⚠️ Non includere le schema nella risposta, non serve, bastano i dati.