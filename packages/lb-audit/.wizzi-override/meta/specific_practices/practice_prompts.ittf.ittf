ittf

    $
        var product_context = '{"product_context":{"manufacturer":"Breton Spa","machine_types":[{"type":"CNC Machining Centers","description":"High-precision CNC machines for stone and metalworking, featuring multi-axis control for complex geometries.","supported_protocols":["OPC UA with Basic256Sha256","PROFINET with PN Security","EtherNet/IP with CIP Security","Modbus TCP with TLS"]},{"type":"Stone Cutting Machines","description":"Automated saws for cutting granite and marble with high-speed, water-cooled blades.","supported_protocols":["OPC UA with Basic256Sha256","PROFINET with PN Security","MQTT with TLS","EtherCAT with Secure Profile"]},{"type":"Polishing Machines","description":"Machines for surface finishing of stone, equipped with automated abrasive tools and precision sensors.","supported_protocols":["OPC UA with Basic256Sha256","PROFINET with PN Security","EtherNet/IP with CIP Security","S7comm with Secure Authentication"]},{"type":"Composite Material Processing Lines","description":"Integrated systems for cutting, shaping, and curing composite materials for aerospace and automotive.","supported_protocols":["OPC UA with Basic256Sha256","PROFINET with PN Security","MQTT with TLS","CANopen with Secure Extensions"]}],"applications":[{"name":"Natural Stone Processing","criticality":"High","description":"Cutting and polishing marble and granite for construction, requiring high precision to avoid material waste."},{"name":"Metalworking for Precision Parts","criticality":"High","description":"Machining metal components for industrial equipment, critical for maintaining tight tolerances."},{"name":"Composite Material Fabrication","criticality":"Medium","description":"Producing lightweight composite parts for aerospace, ensuring structural integrity and quality."},{"name":"Surface Finishing for Decorative Stone","criticality":"Low","description":"Polishing stone surfaces for aesthetic applications, with minimal operational impact if disrupted."}],"key_features":[{"feature":"High-Precision CNC Control Systems","description":"PLC-based systems with sub-millimeter accuracy for complex machining tasks.","security_support":["CR1: Identification and Authentication Control","CR3: System Integrity"]},{"feature":"Secure Remote Access","description":"Enables remote diagnostics and updates via encrypted channels for maintenance.","security_support":["CR4: Data Confidentiality","CR5: Restricted Data Flow"]},{"feature":"Firmware Signing","description":"Ensures only verified firmware is loaded, preventing unauthorized modifications.","security_support":["CR3: System Integrity","CR6: Timely Response to Events"]},{"feature":"Network Segmentation Support","description":"Integrates with OT network zones to isolate critical control functions.","security_support":["CR5: Restricted Data Flow","CR7: Resource Availability"]},{"feature":"Incident Logging","description":"Records security events for analysis, ensuring traceability of unauthorized access.","security_support":["CR6: Timely Response to Events","CR3: System Integrity"]}],"operational_environment":{"description":"Industrial facilities for stone, composite, and metal processing with high dust and noise levels.","conditions":{"temperature_range":"5-40°C","dust_level":"High (stone processing environments)","network_type":"Segmented industrial networks with DMZ for IT-OT integration"}},"industry_4_0_compliance":true,"security_profile":{"supported_sl":["SL 1","SL 2","SL 3"],"certifications":["IEC 62443-4-2","IEC 62443-4-1"],"common_threats":["Ransomware targeting control systems, disrupting production and causing downtime.","MitM attacks on industrial protocols, compromising data integrity.","Data manipulation in HMI interfaces, leading to incorrect process parameters."]},"product_version":{"current_version":"2025.1","last_updated":"2025-06-01"}}}';
        var practice_ia_step_2_json_schema = '{"$schema":"http://json-schema.org/draft-07/schema#","type":"object","properties":{"practice":{"type":"string"},"code":{"type":"string"},"subCode":{"type":"string"},"explanation":{"type":"string","description":"Explanation of the requirement","example":"..."},"context":{"type":"string","description":"Context of the requirement","example":"..."},"challenges":{"type":"array","description":"Challenges of the requirement","items":{"type":"string","example":"..."}},"best_practices":{"type":"array","description":"Best practices for the requirement","items":{"type":"object","properties":{"description":{"type":"string","example":"..."},"url":{"type":"string","example":"https://example.com"},"url_description":{"type":"string","example":"Description (https://example.com"},"url_description":{"type":"string","example":"Description) of the resource"}},"required":["description"],"additionalProperties":false}},"key_aspects":{"type":"array","items":{"type":"object","properties":{"id":{"type":"string"},"title":{"type":"string"},"description":{"type":"string"},"related_links":{"type":"array","items":{"type":"object","properties":{"title":{"type":"string"},"url":{"type":"string"},"description":{"type":"string"}},"required":["title","url","description"],"additionalProperties":false}}},"required":["id","title","description","related_links"],"additionalProperties":false}}},"required":["practice","code","subCode","explanation","context","challenges","best_practices","key_aspects"],"additionalProperties":false}';
        var practice_ia_step_3_json_schema = '{"$schema":"http://json-schema.org/draft-07/schema#","type":"object","description":"Generalized JSON schema for IEC 62443-4-1 practices","required":["practice","code","subCode","name","description","details","standard_compliance","last_updated"],"properties":{"practice":{"type":"string","description":"Numeric identifier of the practice within IEC 62443-4-1","pattern":"^[0-9]+$"},"code":{"type":"string","description":"Alphanumeric code for the practice (e.g., SG-7, SM-5)","pattern":"^[A-Z]{2}-[0-9]+$"},"subCode":{"type":"string"},"name":{"type":"string","description":"Name of the practice (e.g., Documentation review)","minLength":1},"description":{"type":"string","description":"Detailed description of the practice as per IEC 62443-4-1","minLength":1},"details":{"type":"object","description":"Detailed information addressing key aspects of the practice","required":["risk_assessment_and_threat_modeling","audit_and_compliance_verification","training_and_competency_requirements","tooling_and_automation_support","handling_legacy_systems_and_constraints","stakeholder_collaboration_and_governance","continuous_improvement_and_updates"],"properties":{"risk_assessment_and_threat_modeling":{"type":"object","description":"Details for risk assessment and threat modeling related to the practice","required":["why","methodologies","tools","case_study"],"properties":{"why":{"type":"string","minLength":1},"methodologies":{"type":"array","items":{"type":"object","required":["name","description"],"properties":{"name":{"type":"string","minLength":1},"description":{"type":"string","minLength":1}},"additionalProperties":false},"minItems":1},"tools":{"type":"array","items":{"type":"object","required":["name","purpose"],"properties":{"name":{"type":"string","minLength":1},"purpose":{"type":"string","minLength":1}},"additionalProperties":false},"minItems":1},"case_study":{"type":"object","required":["example"],"properties":{"example":{"type":"string","minLength":1}},"additionalProperties":false}},"additionalProperties":false},"audit_and_compliance_verification":{"type":"object","description":"Details for auditing and verifying compliance with the practice","required":["why","audit_checklist","metrics","compliance_procedure"],"properties":{"why":{"type":"string","minLength":1},"audit_checklist":{"type":"array","items":{"type":"string","minLength":1},"minItems":1},"metrics":{"type":"array","items":{"type":"object","required":["kpi","target"],"properties":{"kpi":{"type":"string","minLength":1},"target":{"type":"string","minLength":1}},"additionalProperties":false},"minItems":1},"compliance_procedure":{"type":"string","minLength":1}},"additionalProperties":false},"training_and_competency_requirements":{"type":"object","description":"Details for training and competency requirements","required":["why","training_programs","competency_assessment"],"properties":{"why":{"type":"string","minLength":1},"training_programs":{"type":"array","items":{"type":"object","required":["name","description"],"properties":{"name":{"type":"string","minLength":1},"description":{"type":"string","minLength":1}},"additionalProperties":false},"minItems":1},"competency_assessment":{"type":"string","minLength":1}},"additionalProperties":false},"tooling_and_automation_support":{"type":"object","description":"Details for tools and automation supporting the practice","required":["why","tools","automation_strategy"],"properties":{"why":{"type":"string","minLength":1},"tools":{"type":"array","items":{"type":"object","required":["name","purpose"],"properties":{"name":{"type":"string","minLength":1},"purpose":{"type":"string","minLength":1}},"additionalProperties":false},"minItems":1},"automation_strategy":{"type":"string","minLength":1}},"additionalProperties":false},"handling_legacy_systems_and_constraints":{"type":"object","description":"Details for addressing legacy systems in the practice","required":["why","strategies","example_policy"],"properties":{"why":{"type":"string","minLength":1},"strategies":{"type":"array","items":{"type":"object","required":["approach","description"],"properties":{"approach":{"type":"string","minLength":1},"description":{"type":"string","minLength":1}},"additionalProperties":false},"minItems":1},"example_policy":{"type":"string","minLength":1}},"additionalProperties":false},"stakeholder_collaboration_and_governance":{"type":"object","description":"Details for stakeholder collaboration and governance","required":["why","governance_model","conflict_resolution"],"properties":{"why":{"type":"string","minLength":1},"governance_model":{"type":"object","required":["name","roles"],"properties":{"name":{"type":"string","minLength":1},"roles":{"type":"array","items":{"type":"object","required":["role","responsibility"],"properties":{"role":{"type":"string","minLength":1},"responsibility":{"type":"string","minLength":1}},"additionalProperties":false},"minItems":1}},"additionalProperties":false},"conflict_resolution":{"type":"string","minLength":1}},"additionalProperties":false},"continuous_improvement_and_updates":{"type":"object","description":"Details for continuous improvement and policy updates","required":["why","update_process","lessons_learned"],"properties":{"why":{"type":"string","minLength":1},"update_process":{"type":"array","items":{"type":"object","required":["step","description"],"properties":{"step":{"type":"string","minLength":1},"description":{"type":"string","minLength":1}},"additionalProperties":false},"minItems":1},"lessons_learned":{"type":"string","minLength":1}},"additionalProperties":false}},"additionalProperties":false},"standard_compliance":{"type":"string","description":"Reference to the IEC 62443-4-1 standard","enum":["IEC 62443-4-1"]},"last_updated":{"type":"string","description":"Date of last update in YYYY-MM-DD format","pattern":"^[0-9]{4}-[0-9]{2}-[0-9]{2}$"}},"additionalProperties":false}';
        var practice_ia_step_4_json_schema = '{"$schema":"http://json-schema.org/draft-07/schema#","type":"object","description":"Generalized JSON schema for IEC 62443-4-1 practices","required":["practice","code","subCode","name","description","details","standard_compliance","last_updated"],"properties":{"practice":{"type":"string","description":"Numeric identifier of the practice within IEC 62443-4-1","pattern":"^[0-9]+$"},"code":{"type":"string","description":"Alphanumeric code for the practice (e.g., SG-7, SM-5)","pattern":"^[A-Z]{2}-[0-9]+$"},"subCode":{"type":"string"},"policies":{"type":"array","items":{"type":"object","properties":{"code":{"type":"string"},"subCode":{"type":"string"},"title":{"type":"string"},"description":{"type":"string"},"enforcement":{"type":"string"}}}},"procedures":{"type":"array","items":{"type":"object","properties":{"code":{"type":"string"},"subCode":{"type":"string"},"title":{"type":"string"},"description":{"type":"string"},"steps":{"type":"array","items":{"type":"object","properties":{"step":{"type":"integer"},"action":{"type":"string"},"tools":{"type":"string"},"expected_outcome":{"type":"string"}}}}}},"last_updated":{"type":"string","description":"Date of last update in YYYY-MM-DD format","pattern":"^[0-9]{4}-[0-9]{2}-[0-9]{2}$"}},"additionalProperties":false}';
        var practices = []

    $foreach prItem in std_62443_4_1_extra.items
        $if _.isArray(prItem.subs) == false || prItem.subs.length == 0
            $
                prItem.subCode = '';
                practices.push(prItem);

        $else
            $foreach prItemSub in prItem.subs
                $
                    practices.push({
                        practice: prItem.practice,
                        code: prItem.code,
                        name: prItem.name,
                        description: prItem.description + ' ' + prItemSub.description,
                        subCode: prItemSub.description,
                    });    

    $
        var ia_4_1_step_2_3 = [];

    $foreach item_2 in ai_4_1_step_2_out.practices
        $foreach item_3 in ai_4_1_step_3_out.practices
            $if item_2.practice == item_3.practice && item_2.code == item_3.code && item_2.subCode == item_3.subCode
                $
                    ia_4_1_step_2_3.push(
                        Object.assign({}, item_2, item_3)
                    );

    $file .wizzi-override/docs/4_1/from_meta/practice_prompts.txt.ittf

        txt 
            $foreach prItem in practices
                $ var pr_defJSONString = _.stringify(prItem, null, null)
                =====
                sr ${prItem.practice} ${prItem.code} ${prItem.subCode}
                -----
                Popola un database JSON con dati utili per analizzare le practices dello IEC 62443-4-1, 
                seguendo il JSON schema fornito. 
                Usa il JSON della practice fornito per popolare i campi `practice` e `code` e aggiungi dati coerenti per le 
                proprietà `explanation`, `context`, `challenges`, `best_practices` e `key_aspects`. 
                Segui queste linee guida:
                - Usa un linguaggio tecnico e formale, adatto a ingegneri di sicurezza informatica con esperienza 
                in sistemi di controllo industriale (ICS).
                - Fornisci spiegazioni concise (massimo 100 parole) per `explanation` e `context`.
                - Elenca almeno 5 elementi per `challenges` e `best_practices`, includendo un esempio pratico o 
                scenario reale per ciascun elemento.
                - Per `best_practices`, elenca almeno 4 elementi, includendo un esempio pratico o scenario reale per ciascun elemento. 
                Per ogni best practice, inserisci un link specifico e autorevole (es. guide di vendor, case study, articoli di settore) 
                direttamente correlato alla pratica e al subCode (integrazione del prodotto con l’ambiente previsto). 
                Evita riferimenti generici a standard o framework. 
                Ogni link deve essere accompagnato da una breve descrizione nel testo della best practice che ne spieghi la rilevanza.                
                - Per `key_aspects`, includi almeno 4 aspetti, ciascuno contenente i campi id, title, description e related_links, 
                Ogni oggetto deve essere unico e pertinente alla pratica e al subCode. 
                Campo id: Assegna un identificatore univoco per ogni aspetto (es. "KA1", "KA2", ecc.) per garantire tracciabilità e chiarezza.
                Campo title: Crea un titolo conciso (massimo 5-7 parole) che riassuma l’aspetto chiave della documentazione 
                di configurazione (es. "Configurable Settings Documentation", "Default Settings Analysis"). 
                Il titolo deve riflettere un elemento critico della pratica e del subCode.
                Campo description: Scrivi una descrizione tecnica di 50-100 parole per ogni aspetto- 
                spiegando il suo ruolo nella conformità a SG-3, subCode 2. La descrizione deve:Essere formale e adatta a ingegneri ICS esperti.
                Campo related_links: Per ogni oggetto key_aspects, includi un array di almeno 2 risorse autorevoli e specifiche (es. guide di vendor, case study, pubblicazioni di settore). Ogni risorsa deve:Avere un title chiaro che descriva il contenuto (es. "Cisco Industrial IoT Security Guide").
                Includere un url valido e specifico, evitando riferimenti generici a standard (es. IEC 62443, NIST SP 800-82).
                Fornire una description (massimo 30 parole) che spieghi il legame diretto con l’aspetto e la pratica SG-3, subCode 2 (es. “Guida di Cisco per configurazioni sicure di HMI, allineata a SG-3”).
                Essere tratta da fonti pratiche come linee guida di vendor (es. Siemens, Honeywell, Schneider Electric) 
                o associazioni di settore (es. ISA), privilegiando risorse che offrono esempi concreti o implementazioni.
                - Assicurati che tutte le informazioni siano coerenti con la norma IEC 62443-4-1. 
                - Se il JSON originale manca di dettagli, deduci informazioni plausibili basandoti sulla norma.
                - Verifica che il JSON risultante sia conforme allo schema e privo di errori.
                Usa il seguente JSON schema.
                <database_json_schema>
                ${practice_ia_step_2_json_schema}
                </database_json_schema>
                Popola lo schema con i dati della seguente practice.
                <sr_json>
                ${pr_defJSONString}
                </sr_json>
                Ritorna il JSON risultante.

                -----
                Popola un database JSON con dati utili per analizzare le practices dello IEC 62443-4-1.
                Usa il JSON della practice fornito per popolare i campi `practice` e `code` e aggiungi 
                le proprietà per gli aspetti seguenti quando pertinenti:
                <aspetti>
                $$ Risk Assessment and Threat Modeling: some practices rely on risk-based scoping and threat analysis, 
                $$ critical for ICS environments with high-impact consequences.
                Metodologie per condurre security analyses (e.g., STRIDE, DREAD, or ICS-specific threat models).
                Tools o frameworks raccomandati per il risk assessment in ICS (e.g., NIST 800-30 adapted for SCADA systems).
                Case studies di risk assessments per ICS products (e.g., a DCS in a power plant).
                
                $$ Audit and Compliance Verification: Policies must include procedures for auditing compliance with IEC 62443-4-1, 
                $$ as SM-5 requires expert review and approval.
                Audit checklists or frameworks per verifica la compliance con la pratica.
                
                Procedures for documenting and reviewing compliance evidence (e.g., for SM-4 security expertise or SM-7 secure implementation).
                Metrics or KPIs to measure adherence to 62443-4-1 policies (e.g., percentage of scoped requirements implemented).
                
                $$ Training and Competency Requirements:Why: SM-4 (Security Expertise) and SM-5 emphasize the need for qualified personnel, requiring policies for training and competency validation.
                Recommended training programs for ICS security (e.g., ISA/IEC 62443 certifications, GICSP).
                Procedures for assessing and maintaining security expertise (e.g., annual competency reviews for SM-4).
                Examples of training plans for ICS engineers to support practice.
                
                Automation strategies and integration of tools with DevSecOps pipelines for secure product development (SM-6, SM-7).

                $$ Handling Legacy Systems and Constraints: ICS environments often include legacy systems, 
                $$ posing unique challenges for applying 62443-4-1 practices.
                Strategies for practice requirements when legacy ICS components (e.g., outdated PLCs) cannot meet 
                modern security standards.
                
                Compensating controls for legacy systems (e.g., network segmentation for SM-3 secure design).
                Examples of policies addressing legacy system integration in 62443-4-1 compliance.
                
                Stakeholder Collaboration and Governance: SM-5 and other practices require collaboration between engineering, 
                security, and management teams, necessitating clear governance structures.
                What to Ask: Governance models for overseeing 62443-4-1 implementation (e.g., roles and responsibilities for SM-5 scoping).
                
                -) Procedures for resolving stakeholder conflicts during scoping (e.g., engineering vs. security priorities).
                Examples of RACI matrices for ICS security policy execution.
                
                $$ Continuous Improvement and Updates: Policies must evolve with emerging threats and updates to IEC 62443 standards.
                Processes for updating practice based on new threat intelligence (e.g., CISA alerts for ICS vulnerabilities).
                Feedback loops for refining policies based on audit findings or incidents.
                Guidance on incorporating lessons learned from ICS security incidents into 62443-4-1 policies.
                </aspetti>

                Segui queste linee guida:
                - Usa un linguaggio tecnico e formale, adatto a ingegneri di sicurezza informatica con esperienza 
                - Assicurati che tutte le informazioni siano coerenti con la norma IEC 62443-4-1. 
                Usa il seguente JSON schema.
                <database_json_schema>
                ${practice_ia_step_3_json_schema}
                </database_json_schema>
                Popola lo schema con i dati della seguente practice.
                <practice_json>
                ${pr_defJSONString}
                </practice_json>
                Ritorna il JSON risultante.

            $foreach prItem in ia_4_1_step_2_3
                =====
                sr ${prItem.practice} ${prItem.code} ${prItem.subCode}
                -----
                $ var pr_defJSONString = _.stringify(prItem, null, null)
                Popola un database JSON con dati utili per analizzare le practices dello IEC 62443-4-1.
                Utilizza i dati della practice IEC 62443-4-1 specificata. 
                Includi esclusivamente i campi practice, code e subCode dal JSON di input, 
                omettendo tutti gli altri dati come explanation, context, challenges, best_practices, key_aspects, name, description, details e standard_compliance. 
                Aggiungi le seguenti proprietà: 
                - Un array policies con almeno tre policy pertinenti, ciascuna con code, subCode (coerenti con la practice), 
                title (un titolo chiaro e conciso), description (dettagliata, con contesto applicativo e riferimento a IEC 62443-4-1), 
                e enforcement (meccanismi per garantire conformità, come audit o strumenti).
                - Un array procedures con almeno tre procedure pertinenti, ciascuna con code, subCode (coerenti con la practice), 
                title (un titolo chiaro e conciso), description (spiegazione del processo), e steps (un array di almeno tre step dettagliati, numerati, 
                con azioni specifiche, strumenti consigliati e risultati attesi).
                Segui queste linee guida:
                - Usa un linguaggio tecnico e formale, adatto a ingegneri di sicurezza informatica con esperienza 
                - Assicurati che tutte le informazioni siano coerenti con la norma IEC 62443-4-1. 
                - Mantieni il campo last_updated con il formato YYYY-MM-DD, utilizzando la data attuale (2025-08-07).
                - Non generare dati fittizi per i campi practice, code o subCode; utilizza solo quelli forniti.
                - Per le policy e le procedure, fornisci contenuti originali e dettagliati, evitando di copiare direttamente dal JSON di input.
                Usa il seguente JSON schema.
                <database_json_schema>
                ${practice_ia_step_4_json_schema}
                </database_json_schema>
                Creating policies and procedures consider the following product and system context.
                <product_system_context>
                ${product_context}
                </product_system_context>
                Popola lo schema con i dati della seguente practice.
                <practice_json>
                ${pr_defJSONString}
                </practice_json>
                Ritorna il JSON risultante.


