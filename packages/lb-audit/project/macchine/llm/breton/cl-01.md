# SCHEDA B — Identità macchina & baseline (IEC 62443‑4‑2)

**Ambito**: nuova macchina assemblata, intervento presso il produttore (officina).
**Obiettivo**: creare una **baseline verificabile** di identità e configurazione iniziale, pronta per l’integrazione in sito e per il MSEP.

---

## 1) CHECK‑LIST RAPIDA (da completare prima del rilascio)

* [ ] **Machine Fact Sheet** completa e versionata (modello, SN, controllori, HMI, gateway/PC, rete, protocolli, accessi remoti, dipendenze IT).
  ⟶ File atteso: `Machine_Fact_Sheet_<Famiglia>_<Modello>_vX.Y.pdf`
* [ ] **BOM/SBOM software** con versioni e **hash SHA‑256** dei binari principali.
  ⟶ File attesi: `SBOM_<Modello>_YYYYMMDD.csv` (o `.json` CycloneDX/SPDX) + cartella `HASH/`
* [ ] **Registro versioni iniziale** (mappa firmware/app → versione/seriale).
  ⟶ File atteso: `Registro_Versioni_Initial_<SN>.csv`
* [ ] **Pacchetto fotografico** (targhe, cablaggi, etichette porte) + **Schema I/O safety**.
  ⟶ File attesi: cartella `FOTO_BASELINE/` + `Schema_IO_Safety_<Modello>_vX.Y.pdf`

> **Criteri di accettazione**: tutti i file **versionati**, con **owner** e **data**, nomi coerenti, e **hash** dei documenti PDF/CSV consegnati.

---

## 2) ISTRUZIONI OPERATIVE — punto per punto

### 2.1 Machine Fact Sheet

**Scopo**: descrivere l’identità e il perimetro tecnico della macchina per audit, test e integrazione.

**Contenuti minimi**:

* **Identità**: famiglia/modello, **SN**, versione meccanica/elettrica, revisione software macchina.
* **Controllori**: PLC/CN (marca, modello, FW), **Safety PLC** (marca, modello, FW), moduli I/O chiave.
* **HMI**: pannello/PC, OS (versione/patch level), hardening applicato (es. account, servizi disabilitati).
* **Gateway/PC di servizio**: ruolo (es. edge/NGFW/ingegneria), OS/FW, tool installati.
* **Rete**: schema di officina, **VLAN** (automazione/HMI/esterno), eventuale **DMZ** di cella, indirizzi IP/hostname.
* **Protocolli/servizi**: OPC UA/REST, Modbus/TCP, SMB, RDP/VNC (solo via broker), porta/ruolo.
* **Accessi remoti**: broker/jump host, **MFA**, account **time‑bound**.
* **Dipendenze IT**: **NTP** (sorgenti, auth), **DNS**, repository update (FQDN/porte).

**Formato consigliato**:

* Tabellare (1–2 pagine) + diagramma semplice.
* Campi obbligatori marcati con \* (non lasciare “TBD” al rilascio).

**Esempio di campi**:

* Identità: `Famiglia=PKG‑300`, `Modello=PKG‑312`, `SN=PKG312‑000457`, `Rev Mecc=1.2`, `Rev Elet=1.1`.
* PLC: `Vendor=Siemens`, `Modello=1516F‑3 PN/DP`, `FW=V2.9.2`. Safety PLC idem.
* HMI: `Panel=TP1200`, `OS=Win10 IoT 21H2`, `Patch=KB5030219`, `Hardening=Baseline v1.0`.
* Rete: `VLAN10=Automazione`, `VLAN20=HMI`, `VLAN30=Esterno`, `DMZ=Yes`, `HMI=10.10.20.15`.
* Protocolli: `OPC UA/TLS:4840`, `REST/TLS:443`, `SMBv2 only`, `RDP via broker`.
* Dipendenze: `NTP=ntp.lab.oem.local`, `DNS=10.10.1.10`, `Repo FW=updates.oem.com:443`.

**Uscite**: PDF firmato digitalmente o con hash + sorgente editabile (DOCX/ODS).
**Controllo qualità**: revisione a due persone; nessun campo vuoto; coerenza con Registro Versioni.

---

### 2.2 BOM/SBOM software con versioni e hash

**Scopo**: elencare componenti software/firmware per gestione vulnerabilità, patching e prove.

**Cosa includere** (righe/record):

* **Componente** (es. PLC FW, HMI OS, runtime, tool di progetto, driver, servizi OPC UA/REST).
* **Produttore** e **origine** (fornitore, URL repo o immagine).
* **Versione/Build** (esatta, non “latest”).
* **Identificativo binario**: percorso file/immagine o riferimento al dispositivo.
* **Hash SHA‑256** del binario/immagine consegnata.
* (Opz.) **Licenza** e **CPE**/pURL se disponibili.

**Formato file**:

* Preferito: **CycloneDX** o **SPDX** (`.json`).
* Alternativa semplice: **CSV** con colonne: `component, vendor, version, source, file_path, sha256, notes`.

**Come generare gli hash (indicazioni pratiche)**:

* **Windows** (PowerShell): `Get-FileHash -Algorithm SHA256 <percorso>`
* **Linux**: `sha256sum <percorso>`
* Annotare tool, host e data usati per il calcolo; salvare l’output in `HASH/`.

**Uscite**: `SBOM_<Modello>_YYYYMMDD.csv|json` + cartella `HASH/`.
**Controllo qualità**: hash presenti per **tutti** i binari consegnati; versioni coerenti con Fact Sheet.

---

### 2.3 Registro versioni iniziale (baseline)

**Scopo**: fissare la **baseline** versione per ogni macchina/seriale su firmware/app, per rollback e audit.

**Contenuti minimi** (una riga per componente):

* **Data** e **Owner** del rilascio.
* **Seriale macchina (SN)** e, se utile, **ID armadio** / sottosistemi.
* **Componente** (PLC FW, Safety FW, HMI OS, HMI runtime, Gateway OS, App macchina, Ricette iniziali, Bootloader, ecc.).
* **Versione/Build** e **Hash** (se file esportabile).
* **Note** (es. “baseline collaudo”, “richiede NTP autenticato”).

**Formato file**: CSV semplice (`date, owner, sn, subsystem, component, version, sha256, notes`).
**Naming**: `Registro_Versioni_Initial_<SN>.csv` (es. `Registro_Versioni_Initial_PKG312‑000457.csv`).

**Uscite**: CSV + PDF di riepilogo firmato/hashato.
**Controllo qualità**: corrispondenza 1:1 con Fact Sheet; nessun componente critico senza versione.

---

### 2.4 Fotografie & Schema I/O safety

**Scopo**: produrre **evidenze visive** e lo **schema funzionale safety** utili per audit e manutenzione.

**Shot‑list minima (foto)**:

1. **Targa macchina** (leggibile in macro).
2. **Quadro elettrico**: fronte/retro, interno con portelle aperte (focus su **etichette cavi**).
3. **Controllori**: PLC, **Safety PLC**, moduli I/O (etichette e versioni firmware su display se presenti).
4. **HMI/PC**: schermata info versione OS/runtime.
5. **Gateway/NGFW/edge**: retro con **porte rete etichettate**.
6. **Punti rete** su macchina (RJ45, switch di bordo) con etichettatura.
7. **Dispositivi safety** (E‑Stop, barriere, tappeti) e collegamenti principali.
8. **Numerazione morsetti** e **cablaggio** in prossimità di giunzioni critiche.

**Requisiti foto**:

* Risoluzione ≥ **8 MP**, messa a fuoco su etichette; niente riflessi; timestamp attivo.
* **Naming**: `FOTO_BASELINE/01_Targa_<SN>.jpg`, `02_QuadroFront_<SN>.jpg`, …

**Schema I/O safety**:

* Diagramma aggiornato (PDF) con: dispositivi di sicurezza, canali, PLC safety, interlock, logica di arresto, numerazione morsetti.
* **Naming**: `Schema_IO_Safety_<Modello>_vX.Y.pdf`.

**Uscite**: cartella `FOTO_BASELINE/` completa + PDF schema.
**Controllo qualità**: etichette leggibili, corrispondenza tra schema e foto, elenco file con hash (CSV o manifest TXT).

---

## 3) Errori comuni da evitare

* Lasciare campi “TBD” in Fact Sheet o versioni generiche (“latest”).
* Dimenticare hash per i binari consegnati o usare strumenti diversi senza indicarlo.
* Foto sfocate/illeggibili o senza convenzione di naming.
* Mancata coerenza tra Fact Sheet, SBOM e Registro Versioni.

## 4) Pronti per consegna all’AO (pacchetto)

Confezionare una cartella radice `B_IDENTITA_BASELINE_<SN>_YYYYMMDD/` con:

* `Machine_Fact_Sheet_*.pdf` (+ sorgente), `SBOM_*.csv|json` + `HASH/`, `Registro_Versioni_Initial_*.csv`, `FOTO_BASELINE/`, `Schema_IO_Safety_*.pdf`.
* File `CHECKSUMS.csv` con SHA‑256 di **tutti** i documenti consegnati.
* `README.txt` con contatti, versione pacchetto, istruzioni brevi.
